{"ast":null,"code":"var _interopRequireDefault=require(\"@babel/runtime/helpers/interopRequireDefault\");Object.defineProperty(exports,\"__esModule\",{value:true});exports.createAnimatedEvent=createAnimatedEvent;exports.default=void 0;var _classCallCheck2=_interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));var _createClass2=_interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));var _assertThisInitialized2=_interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));var _inherits2=_interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));var _possibleConstructorReturn2=_interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));var _getPrototypeOf2=_interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));var _reactNative=require(\"react-native\");var _ReanimatedModule=_interopRequireDefault(require(\"../ReanimatedModule\"));var _AnimatedNode2=_interopRequireDefault(require(\"./AnimatedNode\"));var _AnimatedValue=_interopRequireDefault(require(\"./AnimatedValue\"));var _AnimatedAlways=require(\"./AnimatedAlways\");var _invariant=_interopRequireDefault(require(\"fbjs/lib/invariant\"));var _createEventObjectProxyPolyfill=_interopRequireDefault(require(\"./createEventObjectProxyPolyfill\"));function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=(0,_getPrototypeOf2.default)(Derived),result;if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2.default)(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return(0,_possibleConstructorReturn2.default)(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function sanitizeArgMapping(argMapping){var eventMappings=[];var alwaysNodes=[];var getNode=function getNode(node){if(_reactNative.Platform.OS==='web'||_reactNative.Platform.OS==='windows'||_reactNative.Platform.OS==='macos'){return node;}return node.__nodeID;};var traverse=function traverse(value,path){if(value instanceof _AnimatedValue.default){eventMappings.push(path.concat(getNode(value)));}else if(typeof value==='object'&&value.__val){eventMappings.push(path.concat(getNode(value.__val)));}else if(typeof value==='function'){var node=new _AnimatedValue.default(0);alwaysNodes.push((0,_AnimatedAlways.createAnimatedAlways)(value(node)));eventMappings.push(path.concat(getNode(node)));}else if(typeof value==='object'){for(var key in value){traverse(value[key],path.concat(key));}}};(0,_invariant.default)(argMapping[0]&&argMapping[0].nativeEvent,'Native driven events only support animated values contained inside `nativeEvent`.');var ev=argMapping[0].nativeEvent;if(typeof ev==='object'){traverse(ev,[]);}else if(typeof ev==='function'){var proxyHandler={get:function get(target,name){if(name==='__isProxy'){return true;}if(!target[name]&&name!=='__val'){target[name]=new Proxy({},proxyHandler);}return target[name];},set:function set(target,prop,value){if(prop==='__val'){target[prop]=value;return true;}return false;}};var proxy=typeof Proxy==='function'?new Proxy({},proxyHandler):(0,_createEventObjectProxyPolyfill.default)();alwaysNodes.push((0,_AnimatedAlways.createAnimatedAlways)(ev(proxy)));traverse(proxy,[]);}return{eventMappings:eventMappings,alwaysNodes:alwaysNodes};}var AnimatedEvent=function(_AnimatedNode){(0,_inherits2.default)(AnimatedEvent,_AnimatedNode);var _super=_createSuper(AnimatedEvent);function AnimatedEvent(argMapping){var _this;var config=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};(0,_classCallCheck2.default)(this,AnimatedEvent);var _sanitizeArgMapping=sanitizeArgMapping(argMapping),eventMappings=_sanitizeArgMapping.eventMappings,alwaysNodes=_sanitizeArgMapping.alwaysNodes;_this=_super.call(this,{type:'event',argMapping:eventMappings});_defineProperty((0,_assertThisInitialized2.default)(_this),\"__isNative\",true);_this._alwaysNodes=alwaysNodes;return _this;}(0,_createClass2.default)(AnimatedEvent,[{key:\"toString\",value:function toString(){return\"AnimatedEvent, id: \".concat(this.__nodeID);}},{key:\"attachEvent\",value:function attachEvent(viewRef,eventName){for(var i=0;i<this._alwaysNodes.length;i++){this._alwaysNodes[i].__attach();}this.__attach();var viewTag=(0,_reactNative.findNodeHandle)(viewRef);_ReanimatedModule.default.attachEvent(viewTag,eventName,this.__nodeID);}},{key:\"__onEvaluate\",value:function __onEvaluate(){return 0;}},{key:\"detachEvent\",value:function detachEvent(viewRef,eventName){for(var i=0;i<this._alwaysNodes.length;i++){this._alwaysNodes[i].isNativelyInitialized()&&this._alwaysNodes[i].__detach();}var viewTag=(0,_reactNative.findNodeHandle)(viewRef);_ReanimatedModule.default.detachEvent(viewTag,eventName,this.__nodeID);this.__detach();}}]);return AnimatedEvent;}(_AnimatedNode2.default);exports.default=AnimatedEvent;function createAnimatedEvent(argMapping,config){return new AnimatedEvent(argMapping,config);}","map":{"version":3,"sources":["AnimatedEvent.js"],"names":["eventMappings","alwaysNodes","getNode","node","Platform","traverse","value","path","createAnimatedAlways","invariant","argMapping","ev","proxyHandler","get","name","target","set","prop","proxy","constructor","config","sanitizeArgMapping","type","i","viewTag","findNodeHandle","ReanimatedModule"],"mappings":"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","sourcesContent":["import { Platform, findNodeHandle } from 'react-native';\nimport ReanimatedModule from '../ReanimatedModule';\n\nimport AnimatedNode from './AnimatedNode';\nimport InternalAnimatedValue from './AnimatedValue';\nimport { createAnimatedAlways } from './AnimatedAlways';\n\nimport invariant from 'fbjs/lib/invariant';\nimport createEventObjectProxyPolyfill from './createEventObjectProxyPolyfill';\n\nfunction sanitizeArgMapping(argMapping) {\n  // Find animated values in `argMapping` and create an array representing their\n  // key path inside the `nativeEvent` object. Ex.: ['contentOffset', 'x'].\n  const eventMappings = [];\n  const alwaysNodes = [];\n\n  const getNode = node => {\n    if (Platform.OS === 'web' || Platform.OS === 'windows' || Platform.OS === 'macos') {\n      return node;\n    }\n    return node.__nodeID;\n  };\n\n  const traverse = (value, path) => {\n    if (value instanceof InternalAnimatedValue) {\n      eventMappings.push(path.concat(getNode(value)));\n    } else if (typeof value === 'object' && value.__val) {\n      eventMappings.push(path.concat(getNode(value.__val)));\n    } else if (typeof value === 'function') {\n      const node = new InternalAnimatedValue(0);\n      alwaysNodes.push(createAnimatedAlways(value(node)));\n      eventMappings.push(path.concat(getNode(node)));\n    } else if (typeof value === 'object') {\n      for (const key in value) {\n        traverse(value[key], path.concat(key));\n      }\n    }\n  };\n\n  invariant(\n    argMapping[0] && argMapping[0].nativeEvent,\n    'Native driven events only support animated values contained inside `nativeEvent`.'\n  );\n\n  // Assume that the event containing `nativeEvent` is always the first argument.\n  const ev = argMapping[0].nativeEvent;\n  if (typeof ev === 'object') {\n    traverse(ev, []);\n  } else if (typeof ev === 'function') {\n    const proxyHandler = {\n      get: function(target, name) {\n        if (name === '__isProxy') {\n          return true;\n        }\n        if (!target[name] && name !== '__val') {\n          target[name] = new Proxy({}, proxyHandler);\n        }\n        return target[name];\n      },\n      set: function(target, prop, value) {\n        if (prop === '__val') {\n          target[prop] = value;\n          return true;\n        }\n        return false;\n      },\n    };\n\n    const proxy =\n      typeof Proxy === 'function'\n        ? new Proxy({}, proxyHandler)\n        : createEventObjectProxyPolyfill();\n    alwaysNodes.push(createAnimatedAlways(ev(proxy)));\n    traverse(proxy, []);\n  }\n\n  return { eventMappings, alwaysNodes };\n}\n\nexport default class AnimatedEvent extends AnimatedNode {\n  constructor(argMapping, config = {}) {\n    const { eventMappings, alwaysNodes } = sanitizeArgMapping(argMapping);\n    super({ type: 'event', argMapping: eventMappings });\n    this._alwaysNodes = alwaysNodes;\n  }\n\n  toString() {\n    return `AnimatedEvent, id: ${this.__nodeID}`;\n  }\n\n  // The below field is a temporary workaround to make AnimatedEvent object be recognized\n  // as Animated.event event callback and therefore filtered out from being send over the\n  // bridge which was causing the object to be frozen in JS.\n  __isNative = true;\n\n  attachEvent(viewRef, eventName) {\n    for (let i = 0; i < this._alwaysNodes.length; i++) {\n      this._alwaysNodes[i].__attach();\n    }\n    this.__attach();\n    const viewTag = findNodeHandle(viewRef);\n    ReanimatedModule.attachEvent(viewTag, eventName, this.__nodeID);\n  }\n\n  __onEvaluate() {\n    return 0;\n  }\n\n  detachEvent(viewRef, eventName) {\n    for (let i = 0; i < this._alwaysNodes.length; i++) {\n      this._alwaysNodes[i].isNativelyInitialized() &&\n        this._alwaysNodes[i].__detach();\n    }\n    const viewTag = findNodeHandle(viewRef);\n    ReanimatedModule.detachEvent(viewTag, eventName, this.__nodeID);\n    this.__detach();\n  }\n}\n\nexport function createAnimatedEvent(argMapping, config) {\n  return new AnimatedEvent(argMapping, config);\n}\n"]},"metadata":{},"sourceType":"script"}